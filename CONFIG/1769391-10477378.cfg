do term mon
ip routing

! Start with basic cleanup of default config

config-register 0x2102
!ip cef
no ip dhcp excluded-address 10.10.10.1
no ip dhcp pool ccp-pool
no ip domain name yourdomain.com
no username cisco password 0 cisco
line vty 0 4
 no access-class 23 in
no access-list 23
!line 2
! transport input none
no ip http access-class 23
no ip http authentication local
no ip http timeout-policy idle 60 life 86400 requests 10000
no banner exec
no banner login
!no line vty 5 15

logging buffered 64000
!username admin password cisco
!enable secret cisco
service timestamps debug datetime msec
service timestamps log datetime msec
service password-encryption

hostname CPE-MONDEL-1769391-10477378

vtp domain CPE-MONDEL-1769391-10477378
vtp mode transparent

ip sla responder
!ip sla monitor responder

interface vlan1
 description CUST LAN MONDEL-1769391-10477378
 ip address  10.145.103.121 255.255.255.248
 shutdown
 load-interval 30

interface Gig0/0/0
 desc WAN uplink MONDEL-1769391-10477378
 load-interval 30

ip prefix-list BGP-EXPORT description Advertise to PE only networks in this list
ip prefix-list BGP-EXPORT seq 5 deny 0.0.0.0/0
ip prefix-list BGP-EXPORT permit 10.145.103.120/29

route-map BGP-EXPORT-PRI permit 10
 match ip address prefix-list BGP-EXPORT
 set metric 10

route-map BGP-EXPORT-BACKUP permit 10
 match ip address prefix-list BGP-EXPORT
 set metric 20

route-map SET-MED-IN-10 permit 10
 set metric 10
 set local-preference 900

route-map SET-MED-IN-20 permit 10
 set metric 20
!
ip route 212.23.36.0 255.255.255.0 100.64.122.165 250
!
access-list 10 remark MGMT
access-list 10 permit 100.64.122.165
access-list 10 permit 212.23.36.0 0.0.0.255
access-list 10 permit 213.200.89.32 0.0.0.31
snmp-server community CPE73f1G RO 10
snmp-server ifindex persist
snmp-server trap-source Gig0/0/0
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps tty
!snmp-server enable traps envmon
!snmp-server enable traps entity
snmp-server host 212.23.36.110 version 2c CPE73f1G
snmp-server host 212.23.36.145 version 2c CPE73f1G
!
line con 0
 password cisco
!line aux 0
! password cisco
line vty 0 4
 no privilege level 15
 access-class 10 in
 password cisco


no access-list 70
access-list 70 remark Allowed VPN NTP servers
access-list 70 permit 212.23.36.12
access-list 70 permit 212.23.36.150
!
no access-list 68
access-list 68 remark Disable incoming NTP requests
access-list 68 deny any
!
!
!
ntp access-group peer 70
ntp access-group serve-only 68
!
ntp server 212.23.36.12
ntp server 212.23.36.150

! ## Standalone CPE ##

router bgp 65534
timers bgp 10 30
bgp router-id 100.64.122.166
bgp log-neighbor-changes
neighbor 100.64.122.165 remote-as 3257
neighbor 100.64.122.165 description WAN uplink MONDEL-1769391-10477378

address-family ipv4
 redistribute connected route-map BGP-EXPORT-PRI
 redistribute static route-map BGP-EXPORT-PRI
 neighbor 100.64.122.165 activate
 neighbor 100.64.122.165 soft-reconfiguration inbound
 neighbor 100.64.122.165 route-map SET-MED-IN-10 in
 neighbor 100.64.122.165 route-map BGP-EXPORT-PRI out
 no auto-summary
 no synchronization
exit-address-family

! ## Primary CPE + HSRP ##
 
!

track 123 interface vlan1 line-protocol
!
ip route 172.16.0.0 255.255.255.0 192.168.42.10 track 123
ip route 172.16.1.0 255.255.255.0 192.168.42.10 track 123
ip route 172.16.2.0 255.255.254.0 192.168.42.10 track 123
!
ip prefix-list BGP-EXPORT permit 172.16.0.0/24
ip prefix-list BGP-EXPORT permit 172.16.1.0/24
ip prefix-list BGP-EXPORT permit 172.16.2.0/23
! # End of static route section


!
access-list 12 remark Customer SNMP access
access-list 12 permit 170.162.65.128 0.0.0.0
access-list 12 permit 170.162.65.161 0.0.0.0
access-list 12 permit 170.162.65.162 0.0.0.0
access-list 12 permit 170.162.65.164 0.0.0.0
access-list 12 permit 170.162.197.6 0.0.0.0
access-list 12 permit 170.162.197.7 0.0.0.0
snmp-server view CUSTOMER sysUpTime included
snmp-server view CUSTOMER system.5 included
snmp-server view CUSTOMER interfaces.* included
snmp-server community M0ndel3z view CUSTOMER RO 12


interface vlan1
 ip helper-address ['10.58.7.104', '10.58.7.105']
!
!
ip dhcp pool MONDEL-1769391-10477378
network 10.145.103.120 255.255.255.248
default-router  10.145.103.121
dns-server 8.8.8.8
dns-server 1.1.1.1
!
ip dhcp excluded-address  10.145.103.121
!
!
ip prefix-list BGP-DENY description DENY IRT NMS
ip prefix-list BGP-DENY seq 5 deny 212.23.36.0/24
ip prefix-list BGP-DENY seq 10 deny 212.23.36.0/25
ip prefix-list BGP-DENY seq 15 deny 212.23.36.128/25
ip prefix-list BGP-DENY seq 20 permit 0.0.0.0/0 le 32
!
route-map EIGRP-TO-BGP deny 10
 match tag 8928
!
route-map EIGRP-TO-BGP permit 20
 set metric 10
 set weight 0
!
route-map BGP-TO-EIGRP permit 10
 match ip address prefix-list BGP-DENY
 set tag 8928
!
router eigrp 1
 redistribute bgp 65534 metric 2000 1 255 1 1500 route-map BGP-TO-EIGRP
 network 10.145.103.120 0.0.0.7
 no auto-summary
!
router bgp 65534
 bgp bestpath cost-community ignore
 address-family ipv4
 redistribute eigrp 1 route-map EIGRP-TO-BGP
!

ip prefix-list BGP-EXPORT permit 0.0.0.0/0 le 32

ip prefix-list NMS-DENY description DENY IRT NMS
ip prefix-list NMS-DENY seq 5 deny 212.23.36.0/24
ip prefix-list NMS-DENY seq 10 deny 212.23.36.0/25
ip prefix-list NMS-DENY seq 15 deny 212.23.36.128/25
ip prefix-list NMS-DENY seq 20 permit 0.0.0.0/0 le 32

route-map CE-TO-C permit 10
 match ip address prefix-list NMS-DENY
!
router bgp 65534
 neighbor 169.254.0.1 remote-as 65000
 neighbor 169.254.0.1 description to LAN
 address-family ipv4
 neighbor 169.254.0.1 activate
 neighbor 169.254.0.1 send-community
 neighbor 169.254.0.1 next-hop-self
 neighbor 169.254.0.1 soft-reconfiguration inbound
 neighbor 169.254.0.1 route-map CE-TO-C out
 exit-address-family


ip prefix-list BGP-DENY description DENY IRT NMS
ip prefix-list BGP-DENY seq 5 deny 212.23.36.0/24
ip prefix-list BGP-DENY seq 10 deny 212.23.36.0/25
ip prefix-list BGP-DENY seq 15 deny 212.23.36.128/25
ip prefix-list BGP-DENY seq 20 permit 0.0.0.0/0 le 32

route-map BGP-TO-OSPF permit 10
 match ip address prefix-list BGP-DENY
 set tag 8928
!
route-map OSPF-TO-BGP deny 10
 match tag 8928
!
route-map OSPF-TO-BGP permit 20
 set metric 10
 set weight 0

router ospf 1
 log-adjacency-changes
 redistribute bgp 65534 metric 10 subnets route-map BGP-TO-OSPF
 passive-interface default
 no passive-interface vlan1
 network 10.145.103.120 0.0.0.7 area 0

!
router bgp 65534
 address-family ipv4
 redistribute ospf 1 route-map OSPF-TO-BGP
!

!#############################################################
!## Please ensure you have a secondary session opened to the CPE.
!## Paste the below config with care and on parts.
!## http://intranet/ShortUrl/198376a8
!#############################################################

! Allow login access from below networks
access-list 10 permit 192.168.118.0 0.0.1.255
access-list 10 permit 192.168.120.0 0.0.3.255
!
username leonhard-kurz privilege 0 password cisco
!
privilege exec level 6 access-enable
privilege exec level 6 access-profile
privilege exec level 6 clear
privilege exec level 6 connect
privilege exec level 6 crypto
privilege exec level 6 disable
privilege exec level 6 disconnect
privilege exec level 6 help
privilege exec level 6 lock
privilege exec level 6 login
privilege exec level 6 modemui
privilege exec level 6 mrinfo
privilege exec level 6 router
privilege exec level 6 mstat
privilege exec level 6 mtrace
privilege exec level 6 name-connection
privilege exec level 6 pad
privilege exec level 6 ppp
privilege exec level 6 release
privilege exec level 6 renew
privilege exec level 6 resume
privilege exec level 6 rlogin
privilege exec level 6 set
privilege exec level 6 slip
privilege exec level 6 ssh
privilege exec level 6 systat
privilege exec level 6 tclquit
privilege exec level 6 telnet
privilege exec level 6 terminal
privilege exec level 6 tn3270
privilege exec level 6 tunnel
privilege exec level 6 udptn
privilege exec level 6 where
privilege exec level 6 x28
privilege exec level 6 x3
privilege exec level 0 traceroute
privilege exec level 0 ping
!


ip prefix-list BGP-EXPORT permit ['10.145.1.8/32']
interface Loopback[100]
 desc CUST LOOPBACK 1769391-10477378
 ip address ['10.145.1.8/32']
 shutdown


line vty 0 4
 transport input telnet ssh

 ! Specify miscellaneous IP options and remove default route
ip subnet-zero
no ip source-route
ip tcp path-mtu-discovery
no ip domain-lookup
no ip finger
ip classless
no ip http server
no ip http secure-server

no ip route 0.0.0.0 0.0.0.0

end

! vlan database

! vtp domain CPE-MONDEL-1769391-10477378
! vtp transparent

exit

